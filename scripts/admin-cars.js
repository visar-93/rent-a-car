let products = [    //Create an array which contains informations about cars
    {
        id: 1,
        title: 'Audi A3',
        persons: 5,
        bags: 5,
        fuelType: 'D',
        transmission: 'A',
        climatisation: 'AC',
        price: 59.99,
        image: 'assets/images/car1.jpg'
    },
    {
        id: 2,
        title: 'Audi A3',
        persons: 5,
        bags: 5,
        fuelType: 'P',
        transmission: 'M',
        climatisation: 'AC',
        price: 49.99,
        image: 'assets/images/car2.jpg'
    },
    {
        id: 3,
        title: 'VW Polo R-Line',
        persons: 5,
        bags: 5,
        fuelType: 'P',
        transmission: 'A',
        climatisation: 'AC',
        price: 49.99,
        image: 'assets/images/car4.jpg'
    },
    {
        id: 4,
        title: 'Audi Q7',
        persons: 7,
        bags: 5,
        fuelType: 'D',
        transmission: 'A',
        climatisation: 'AC',
        price: 129.99,
        image: 'assets/images/car10.jpg'
    },
    {
        id: 5,
        title: 'Audi Q7',
        persons: 5,
        bags: 5,
        fuelType: 'D',
        transmission: 'A',
        climatisation: 'AC',
        price: 99.99,
        image: 'assets/images/car11.jpg'
    },
    {
        id: 6,
        title: 'Mercedes S-500 AMG',
        persons: 5,
        bags: 5,
        fuelType: 'D',
        transmission: 'A',
        climatisation: 'AC',
        price: 109.99,
        image: 'assets/images/car12.jpg'
    },
    {
        id: 7,
        title: 'Audi Q7',
        persons: 7,
        bags: 5,
        fuelType: 'D',
        transmission: 'A',
        climatisation: 'AC',
        price: 129.99,
        image: 'assets/images/car10.jpg'
    },
    {
        id: 8,
        title: 'Mercedes E-220',
        persons: 5,
        bags: 5,
        fuelType: 'D',
        transmission: 'M',
        climatisation: 'AC',
        price: 49.99,
        image: 'assets/images/car13.jpg'
    },
    {
        id: 9,
        title: 'Mercedes C-200',
        persons: 5,
        bags: 5,
        fuelType: 'D',
        transmission: 'M',
        climatisation: 'AC',
        price: 39.99,
        image: 'assets/images/car14.jpg'
    },
    {
        id: 10,
        title: 'Mercedes Sprinter',
        persons: 9,
        bags: 5,
        fuelType: 'D',
        transmission: 'M',
        climatisation: 'AC',
        price: 69.99,
        image: 'assets/images/car15.jpg'
    },
    {
        id: 11,
        title: 'Audi Q7',
        persons: 7,
        bags: 5,
        fuelType: 'D',
        transmission: 'A',
        climatisation: 'AC',
        price: 129.99,
        image: 'assets/images/car10.jpg'
    },
    {
        id: 12,
        title: 'VW Polo',
        persons: 5,
        bags: 5,
        fuelType: 'D',
        transmission: 'M',
        climatisation: 'AC',
        price: 19.99,
        image: 'assets/images/car5.jpg'
    },
    {
        id: 13,
        title: 'Golf 7',
        persons: 5,
        bags: 5,
        fuelType: 'D',
        transmission: 'M',
        climatisation: 'AC',
        price: 19.99,
        image: 'assets/images/car7.jpg'
    },
    {
        id: 14,
        title: 'Audi A3',
        persons: 5,
        bags: 5,
        fuelType: 'D',
        transmission: 'M',
        climatisation: 'AC',
        price: 19.99,
        image: 'assets/images/car3.jpg'
    },
    {
        id: 15,
        title: 'Mercedes C-200',
        persons: 5,
        bags: 5,
        fuelType: 'D',
        transmission: 'M',
        climatisation: 'AC',
        price: 39.99,
        image: 'assets/images/car14.jpg'
    },
    {
        id: 16,
        title: 'VW Passat',
        persons: 5,
        bags: 5,
        fuelType: 'D',
        transmission: 'M',
        climatisation: 'AC',
        price: 39.99,
        image: 'assets/images/car8.jpg'
    },
    {
        id: 17,
        title: 'VW Passat',
        persons: 5,
        bags: 5,
        fuelType: 'D',
        transmission: 'M',
        climatisation: 'AC',
        price: 39.99,
        image: 'assets/images/car9.jpg'
    },
    {
        id: 18,
        title: 'Mercedes C-200',
        persons: 5,
        bags: 5,
        fuelType: 'D',
        transmission: 'M',
        climatisation: 'AC',
        price: 39.99,
        image: 'assets/images/car14.jpg'
    },
    {
        id: 19,
        title: 'VW Golf 7 R-Line',
        persons: 5,
        bags: 5,
        fuelType: 'D',
        transmission: 'A',
        climatisation: 'AC',
        price: 39.99,
        image: 'assets/images/car6.jpg'
    },
    {
        id: 20,
        title: 'Audi Q7',
        persons: 7,
        bags: 5,
        fuelType: 'D',
        transmission: 'A',
        climatisation: 'AC',
        price: 129.99,
        image: 'assets/images/car10.jpg'
    },
    {
        id: 21,
        title: 'Mercedes C-200',
        persons: 5,
        bags: 5,
        fuelType: 'D',
        transmission: 'M',
        climatisation: 'AC',
        price: 39.99,
        image: 'assets/images/car14.jpg'
    },
    {
        id: 22,
        title: 'VW Passat',
        persons: 5,
        bags: 5,
        fuelType: 'D',
        transmission: 'M',
        climatisation: 'AC',
        price: 39.99,
        image: 'assets/images/car9.jpg'
    },
    {
        id: 23,
        title: 'VW Golf 7 R-Line',
        persons: 5,
        bags: 5,
        fuelType: 'D',
        transmission: 'A',
        climatisation: 'AC',
        price: 39.99,
        image: 'assets/images/car6.jpg'
    },
    {
        id: 24,
        title: 'VW Passat',
        persons: 5,
        bags: 5,
        fuelType: 'D',
        transmission: 'M',
        climatisation: 'AC',
        price: 39.99,
        image: 'assets/images/car9.jpg'
    },
    {
        id: 25,
        title: 'VW Golf 7 R-Line',
        persons: 5,
        bags: 5,
        fuelType: 'D',
        transmission: 'A',
        climatisation: 'AC',
        price: 39.99,
        image: 'assets/images/car6.jpg'
    },
    {
        id: 26,
        title: 'VW Passat',
        persons: 5,
        bags: 5,
        fuelType: 'D',
        transmission: 'M',
        climatisation: 'AC',
        price: 39.99,
        image: 'assets/images/car9.jpg'
    },
    {
        id: 27,
        title: 'Mercedes C-200',
        persons: 5,
        bags: 5,
        fuelType: 'D',
        transmission: 'M',
        climatisation: 'AC',
        price: 39.99,
        image: 'assets/images/car14.jpg'
    },
    {
        id: 28,
        title: 'VW Golf 7 R-Line',
        persons: 5,
        bags: 5,
        fuelType: 'D',
        transmission: 'A',
        climatisation: 'AC',
        price: 39.99,
        image: 'assets/images/car6.jpg'
    },
    {
        id: 29,
        title: 'VW Passat',
        persons: 5,
        bags: 5,
        fuelType: 'D',
        transmission: 'M',
        climatisation: 'AC',
        price: 39.99,
        image: 'assets/images/car9.jpg'
    },
    {
        id: 30,
        title: 'VW Passat',
        persons: 5,
        bags: 5,
        fuelType: 'D',
        transmission: 'M',
        climatisation: 'AC',
        price: 39.99,
        image: 'assets/images/car9.jpg'
    },
    {
        id: 31,
        title: 'VW Golf 7 R-Line',
        persons: 5,
        bags: 5,
        fuelType: 'D',
        transmission: 'A',
        climatisation: 'AC',
        price: 39.99,
        image: 'assets/images/car6.jpg'
    },
    {
        id: 32,
        title: 'VW Passat',
        persons: 5,
        bags: 5,
        fuelType: 'D',
        transmission: 'M',
        climatisation: 'AC',
        price: 39.99,
        image: 'assets/images/car9.jpg'
    },
    {
        id: 33,
        title: 'Mercedes C-200',
        persons: 5,
        bags: 5,
        fuelType: 'D',
        transmission: 'M',
        climatisation: 'AC',
        price: 39.99,
        image: 'assets/images/car14.jpg'
    },
    {
        id: 34,
        title: 'VW Golf 7 R-Line',
        persons: 5,
        bags: 5,
        fuelType: 'D',
        transmission: 'A',
        climatisation: 'AC',
        price: 39.99,
        image: 'assets/images/car6.jpg'
    },
    {
        id: 35,
        title: 'VW Passat',
        persons: 5,
        bags: 5,
        fuelType: 'D',
        transmission: 'M',
        climatisation: 'AC',
        price: 39.99,
        image: 'assets/images/car9.jpg'
    },
    {
        id: 36,
        title: 'VW Golf 7 R-Line',
        persons: 5,
        bags: 5,
        fuelType: 'D',
        transmission: 'A',
        climatisation: 'AC',
        price: 39.99,
        image: 'assets/images/car6.jpg'
    },
    {
        id: 37,
        title: 'VW Passat',
        persons: 5,
        bags: 5,
        fuelType: 'D',
        transmission: 'M',
        climatisation: 'AC',
        price: 39.99,
        image: 'assets/images/car9.jpg'
    },
    {
        id: 38,
        title: 'VW Golf 7 R-Line',
        persons: 5,
        bags: 5,
        fuelType: 'D',
        transmission: 'A',
        climatisation: 'AC',
        price: 39.99,
        image: 'assets/images/car6.jpg'
    },
    {
        id: 39,
        title: 'VW Passat',
        persons: 5,
        bags: 5,
        fuelType: 'D',
        transmission: 'M',
        climatisation: 'AC',
        price: 39.99,
        image: 'assets/images/car9.jpg'
    },
    {
        id: 40,
        title: 'Mercedes C-200',
        persons: 5,
        bags: 5,
        fuelType: 'D',
        transmission: 'M',
        climatisation: 'AC',
        price: 39.99,
        image: 'assets/images/car14.jpg'
    },
    {
        id: 41,
        title: 'VW Passat',
        persons: 5,
        bags: 5,
        fuelType: 'D',
        transmission: 'M',
        climatisation: 'AC',
        price: 39.99,
        image: 'assets/images/car9.jpg'
    },
    {
        id: 42,
        title: 'VW Golf 7 R-Line',
        persons: 5,
        bags: 5,
        fuelType: 'D',
        transmission: 'A',
        climatisation: 'AC',
        price: 39.99,
        image: 'assets/images/car6.jpg'
    }

]

// arsyeja e kthimit te card-it ne DOM eshte sepse funksionet nuk funksionojne ne HTML string
function createOfferRow(prod) {
    const tr = document.createElement('tr');

    const th = document.createElement('th');
    th.setAttribute('scope', 'row');
    th.innerHTML = prod.id;


    const td1 = document.createElement('td');
    td1.innerHTML = prod.title;

    const td2 = document.createElement('td');
    td2.innerHTML = prod.persons;

    const td3 = document.createElement('td');
    td3.innerHTML = prod.bags;

    const td4 = document.createElement('td');
    td4.innerHTML = prod.fuelType;

    const td5 = document.createElement('td');
    td5.innerHTML = prod.transmission;

    const td6 = document.createElement('td');
    td6.innerHTML = prod.climatisation;

    const td7 = document.createElement('td');
    td7.innerHTML = prod.price;


    const td8 = document.createElement('td');
    const btn1 = document.createElement('button');

    btn1.className = "btn btn-secondary";

    btn1.innerHTML = 'View';
    btn1.addEventListener('click', function () {

        renderModal(prod); // prod is an element of array products
    });


    const td9 = document.createElement('td');
    const btn2 = document.createElement('button');

    btn2.className = "btn btn-warning";

    btn2.innerHTML = 'Edit';
    btn2.addEventListener('click', function () {

        renderModalEdit(prod);
    });

    const td10 = document.createElement('td');
    const btn3 = document.createElement('button');

    btn3.className = "btn btn-danger";

    btn3.innerHTML = 'Delete';
    btn3.addEventListener('click', function () {

        products = products.filter(function (product) {
            return (product.id !== prod.id);             // filter array with products that fulfill the condition

        });
        renderPagination(getPageCount(products)); // render elements of array product based on number of products per page
        loadPage(currentPage); // load page
    });


    td8.appendChild(btn1);
    td9.appendChild(btn2);
    td10.appendChild(btn3);

    tr.appendChild(th);
    tr.appendChild(td1);
    tr.appendChild(td2);
    tr.appendChild(td3);
    tr.appendChild(td4);
    tr.appendChild(td5);
    tr.appendChild(td6);
    tr.appendChild(td7);
    tr.appendChild(td8);
    tr.appendChild(td9);
    tr.appendChild(td10);


    return tr;

};

function renderProducts(products) {    //Function that will render html document filled with class methods
    const root = document.getElementById('table-placeholder');
    root.querySelectorAll('tr').forEach(t => t.remove()) // clear all nodes on that table body

    for (let i = 0; i < products.length; i++) {
        const product = products[i];
    
        const tr = createOfferRow(product)
        root.appendChild(tr)
    }
}

// Pagination for list elements 
let currentPage = 1; // current page 

$(document).ready(function () {
    renderPagination(getPageCount(products));
    loadPage(currentPage);
});

function getPageCount(arr, size = 8) {       // it takes as argument an array and returns the number of pages
    let pages = Math.ceil((arr.length / size));

    return pages;
}

function renderPagination(count) {  // it takes as argument an int(nr. of pages) and renders page products
    const root = document.getElementById('pagination')
    // let htmlPag = '';  // create an empty string
    root.querySelectorAll('*').forEach(t => t.remove())
    for (let i = 1; i <= count; i++) {
        const li = document.createElement('li');
        li.className = `pageNumber ${i == 1 ? 'active' : ''}`;
        li.innerHTML = i.toString();
        li.addEventListener('click', function () {
            $('.pagination').find('.pageNumber.active').removeClass('active');
            $(this).addClass('active');
            currentPage = i;
            loadPage(i);
        });

        root.appendChild(li);
    }
    // document.getElementById('pagination').innerHTML = htmlPag;
}

function loadPage(page) {  // it takes as argument the number of a page and renders products for that page
    let start = 8 * (page - 1), end = start + 8; // it will show max 12 elements for one page 
    const pageProducts = products.slice(start, end); // it creates a temporary array with selected elements of the main array
    renderProducts(pageProducts); // it renders html elements between start and end indexes
}

//Pagiantion HTML - Next and Previous buttons
$(document).ready(function () {
    $('.next').click(function () {

        $('.pagination').find('.pageNumber.active').next().addClass('active');
        $('.pagination').find('.pageNumber.active').prev().removeClass('active');
        if (currentPage === getPageCount(products)) {
            return;
        }
        else {
            currentPage++;
        }
        loadPage(currentPage);

    });
    $('.previous').click(function () {

        $('.pagination').find('.pageNumber.active').prev().addClass('active');
        $('.pagination').find('.pageNumber.active').next().removeClass('active');
        if (currentPage === 1) {
            return;
        }
        else {
            currentPage--;
        }
        loadPage(currentPage);
    });

    document.getElementById('edit-button').addEventListener('click', updateProduct);
    document.getElementById('create-new').addEventListener('click', createProduct);
    document.getElementById('create-button').addEventListener('click', renderModalCreate);
});

// Modal 

function createModal(prod) {

    return `
    <h5>ID:</h5>
    <p>${prod.id}</p>
    <h5>Car:</h5>
    <p>${prod.title}</p>
    <h5>Person:</h5>
    <p>${prod.persons}</p>
    <h5>Bags:</h5>
    <p>${prod.bags}</p>
    <h5>Fuel Type:</h5>
    <p>${prod.fuelType}</p>
    <h5>Transmission:</h5> 
    <p>${prod.transmission}</p>
    <h5>Climatisation:</h5>
    <p>${prod.climatisation}</p>
    <h5>Price:</h5>
    <p>${prod.price}</p>
    <h5>Image:</h5>
    <p>"${prod.image}"</p>`;
};


function renderModal(product) {
    let modalString = '';
    modalString += createModal(product);
    document.getElementById('modal-placeholder1').innerHTML = modalString;

    $('#modal-demo').modal({ show: true });
};

function renderModalEdit(product) {
    openEditCard(product);
    $('#modal-demo2').modal({ show: true });
};

function renderModalCreate() {
    openCreateCard();
    $('#modal-demo3').modal({ show: true });
};


function openEditCard(prod) {
    const inp1 = document.getElementById('id');
    inp1.value = prod.id;

    const inp2 = document.getElementById('car')
    inp2.value = prod.title;

    const inp3 = document.getElementById('person');
    inp3.value = prod.persons;

    const inp4 = document.getElementById('bags');
    inp4.value = prod.bags;

    const inp5 = document.getElementById('fuel-type');
    inp5.value = prod.fuelType;

    const inp6 = document.getElementById('transmission');
    inp6.value = prod.transmission;

    const inp7 = document.getElementById('climatisation');
    inp7.value = prod.climatisation;

    const inp8 = document.getElementById("price");
    inp8.value = prod.price;

    const inp9 = document.getElementById('image');
    inp9.value = prod.image;
}

function updateProduct(e) {
    const id = parseInt(document.getElementById('id').value);
    const product = products.find(p => p.id === id);

    if (!product) return; // if returns null

    product.title = document.getElementById('car').value;
    product.persons = parseInt(document.getElementById('person').value);
    product.fuelType = document.getElementById('fuel-type').value;
    product.transmission = document.getElementById('transmission').value;
    product.climatisation = document.getElementById('climatisation').value;
    product.price = parseFloat(document.getElementById('price').value);
    product.image = document.getElementById('image').value;

    // close modal
    // render current page again


    $('#modal-demo2').modal('hide')
    loadPage(currentPage);
}

function findId(prod) {
    let max = 0;

    for (let i = 0; i <= prod.length - 1; i++) {
        if (prod[i].id > max)
            max = prod[i].id;
    }

    return max;
}

function openCreateCard() {

    const id = findId(products) + 1;
    const inp1 = document.getElementById('idc');
    inp1.value = id;

    const inp2 = document.getElementById('carc')
    inp2.value = "";

    const inp3 = document.getElementById('personc');
    inp3.value = "";

    const inp4 = document.getElementById('bagsc');
    inp4.value = "";

    const inp5 = document.getElementById('fuel-typec');
    inp5.value = "";

    const inp6 = document.getElementById('transmissionc');
    inp6.value = "";

    const inp7 = document.getElementById('climatisationc');
    inp7.value = "";

    const inp8 = document.getElementById("pricec");
    inp8.value = "";

    const inp9 = document.getElementById('imagec');
    inp9.value = "";
}

function createProduct() {

    products.push(
        {

            id: parseInt(document.getElementById('idc').value),
            title: document.getElementById('carc').value,
            persons: parseInt(document.getElementById('personc').value),
            bags: parseInt(document.getElementById('bagsc').value),
            fuelType: document.getElementById('fuel-typec').value,
            transmission: document.getElementById('transmissionc').value,
            climatisation: document.getElementById('climatisationc').value,
            price: parseFloat(document.getElementById('pricec').value),
            image: document.getElementById('imagec').value
        }
    );

    renderPagination(getPageCount(products));

    // close modal
    // render current page again

    $('#modal-demo3').modal('hide')
    loadPage(currentPage);
}
